version: 0.1
component: build
timeoutInSeconds: 20000
runAs: root
shell: bash
env:
  vaultVariables:
    SECRET_1 : "ocid1.vaultsecret.oc1.iad.amaaaaaa4725fbqacbgxnxd4qx5c2iojhuus5elvulqrstpiviwf7hgv244q"
    SECRET_2 : "ocid1.vaultsecret.oc1.iad.amaaaaaa4725fbqake7fra6eruaov6bgxmdpqkaguize5yqva6mpeb2u66mq"
steps:
  - type: Command
    name: "Build Hello World"
    timeoutInSeconds: 10000
    command: |
      cd src/com/sample/
      javac HelloWorld.java
    onFailure:
      - type: Command
        command: |
          echo "Building Hello World failed"
        timeoutInSeconds: 1000
        runAs: root
  - type: Command
    timeoutInSeconds: 10000
    name: "Create Docker image"
    command: |
      docker build -t hello-world:1.0 .
    onFailure:
      - type: Command
        command: |
          echo "Creating Docker image failed"
        timeoutInSeconds: 1000
        runAs: root
  - type: Command
    name: "Saving Secrets"
    command: |
      echo "SECRET 1: ${SECRET_1}" > secrets.txt
      echo "SECRET 2: ${SECRET_2}" >> secrets.txt
    onFailure:
      - type: Command
        command: |
          echo "Saving secrets failed"
        runAs: root

outputArtifacts:
  - name: secrets
    type: BINARY
    location: secrets.txt
